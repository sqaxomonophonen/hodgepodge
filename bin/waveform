#!/bin/bash

if [ -z "$2" ] ; then
	echo "usage: $0 <audio file> <png output> [width:5000] [height:500]"
	exit 1
fi

width=5000
height=500

if [ -n "$3" ] ; then
	width=$3
fi

if [ -n "$4" ] ; then
	height=$4
fi

gp() {
gnuplot <<EOF
set terminal png size $width,$height;
set output '$2';

unset key;
unset tics;
unset border;
set lmargin 0;
set rmargin 0;
set tmargin 0;
set bmargin 0;

plot '$1' binary filetype=bin format='%int16' endian=little array=1:0 with lines;
EOF
}

gp <(ffmpeg -i "$1" -ac 1 -filter:a aresample=8000 -map 0:a -c:a pcm_s16le -f data -) "$2" $width $height
